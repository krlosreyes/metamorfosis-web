---
import { getPosts } from "../utils/posts";
import Layout from "../layouts/Layout.astro";
import MetabolicQuiz from "../components/MetabolicQuiz.astro";

interface Post {
	id: string;
	metadata?: {
		seoTitle?: string;
		seoDescription?: string;
		publishedAt?: string;
		slug?: string;
		tags?: string[];
		thumbnailUrl?: string;
		category?: string;
		readingTime?: number;
	};
	title?: string;
}

const posts = (await getPosts()) as Post[];
---

<Layout
	title="Metamorfosis Real - Ingeniería Humana para una Vida sin Límites"
	description="Guías prácticas sobre salud metabólica, ayuno intermitente y transformación física. Basado en ciencia, escrito con experiencia."
>
	<!-- Hero Section -->
	<section
		class="relative h-[80vh] min-h-[600px] flex items-center overflow-hidden bg-gray-900"
	>
		<!-- Slider Container -->
		<div class="absolute inset-0 z-0 select-none pointer-events-none">
			<!-- Image 1: Mountain Sunrise (Aspirational) -->
			<div
				id="hero-slide-0"
				class="hero-slide absolute inset-0 bg-cover bg-center transition-opacity duration-1000 ease-in-out opacity-100"
				style="background-image: url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?auto=format&fit=crop&q=80&w=1920');"
			>
			</div>
			<!-- Image 2: Forest (Organic/Biological) -->
			<div
				id="hero-slide-1"
				class="hero-slide absolute inset-0 bg-cover bg-center transition-opacity duration-1000 ease-in-out opacity-0"
				style="background-image: url('https://images.unsplash.com/photo-1441974231531-c6227db76b6e?auto=format&fit=crop&q=80&w=1920');"
			>
			</div>
			<!-- Image 3: Vitality (Human) - Replaced with Beach (Peace/Freedom) -->
			<div
				id="hero-slide-2"
				class="hero-slide absolute inset-0 bg-cover bg-center transition-opacity duration-1000 ease-in-out opacity-0"
				style="background-image: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&q=80&w=1920');"
			>
			</div>
		</div>

		<!-- Overlay (Gradient for readability) -->
		<div
			class="absolute inset-0 z-[1] bg-gradient-to-b from-black/70 via-black/30 to-black/70"
		>
		</div>

		<!-- Content -->
		<div
			class="relative z-10 container mx-auto px-4 sm:px-6 lg:px-8 flex flex-col items-center justify-center h-full text-center"
		>
			<div class="mb-8">
				<span
					class="inline-block py-1 px-3 rounded-full bg-[#00C49A]/20 text-[#00C49A] text-sm font-semibold border border-[#00C49A]/30 mb-4 backdrop-blur-sm"
				>
					Nuevo Algoritmo 2026
				</span>
				<h1
					class="text-4xl sm:text-6xl font-extrabold tracking-tight text-white mb-6 text-balance leading-tight drop-shadow-lg"
				>
					Tu metabolismo es el software.<br />
					<span
						class="text-transparent bg-clip-text bg-gradient-to-r from-[#00C49A] to-[#007BFF]"
					>
						Es hora de actualizarlo.
					</span>
				</h1>

				<p
					class="text-lg sm:text-xl text-gray-200 mb-8 max-w-2xl mx-auto font-medium drop-shadow-md"
				>
					Descubre tu Índice Metabólico Personal (IMX) y desbloquea el
					protocolo exacto para recuperar tu energía y composición
					física.
				</p>
			</div>

			<!-- Quiz Component -->
			<MetabolicQuiz />

			<p class="mt-8 text-sm text-gray-400">
				Basado en 4 pilares: Nutrición, Ayuno, Sueño y Ejercicio.
			</p>
		</div>
	</section>

	<script>
		// Hero Slider Logic
		const slides = document.querySelectorAll(".hero-slide");
		let currentSlide = 0;
		const totalSlides = slides.length;
		const intervalTime = 10000; // 10 seconds

		function nextSlide() {
			// Fade out current
			slides[currentSlide].classList.remove("opacity-100");
			slides[currentSlide].classList.add("opacity-0");

			// Calculate next
			currentSlide = (currentSlide + 1) % totalSlides;

			// Fade in next
			slides[currentSlide].classList.remove("opacity-0");
			slides[currentSlide].classList.add("opacity-100");
		}

		if (totalSlides > 0) {
			setInterval(nextSlide, intervalTime);
		}
	</script>

	<!-- Posts Section -->
	<section id="posts" class="bg-gray-50/50">
		<!-- Section Header -->
		<div
			class="w-full bg-gradient-to-r from-[#00C49A]/5 via-white to-[#007BFF]/5 border-y border-gray-100 py-16 mb-16"
		>
			<div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center">
				<h2
					class="text-3xl md:text-4xl font-extrabold text-gray-900 tracking-tight mb-4 text-balance"
				>
					Aqui comienza tu Transformación
				</h2>
			</div>
		</div>

		<div class="container mx-auto px-4 sm:px-6 lg:px-8 pb-24">
			<div class="max-w-6xl mx-auto">
				{
					posts.length > 0 ? (
						<div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
							{posts.map((post) => (
								<article class="group bg-white rounded-2xl shadow-sm hover:shadow-xl border border-gray-100/50 overflow-hidden transition-all duration-300 hover:-translate-y-1 h-full flex flex-col">
									{/* Thumbnail Placeholder - To be dynamic later */}
									<div class="h-48 bg-gradient-to-br from-[#00C49A]/10 to-[#007BFF]/10 flex items-center justify-center relative overflow-hidden">
										{post.metadata?.thumbnailUrl ? (
											<img
												src={post.metadata.thumbnailUrl}
												alt={post.title}
												class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
											/>
										) : (
											<div class="text-[#007BFF] opacity-20">
												<svg
													class="w-16 h-16"
													fill="currentColor"
													viewBox="0 0 24 24"
												>
													<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z" />
												</svg>
											</div>
										)}
										<div class="absolute top-4 right-4">
											<span class="inline-flex items-center px-3 py-1 text-xs font-bold text-[#004d3d] bg-white/90 backdrop-blur-sm rounded-full shadow-sm">
												{post.metadata?.category ||
													"Guía"}
											</span>
										</div>
									</div>

									<div class="p-8 flex-1 flex flex-col">
										<h3 class="text-xl font-bold mb-3 text-gray-900 group-hover:text-[#007BFF] transition-colors line-clamp-2 leading-tight">
											<a
												href={`/posts/${
													post.metadata?.slug ||
													post.id
												}`}
											>
												{post.metadata?.seoTitle ||
													post.title ||
													"Sin Título"}
											</a>
										</h3>

										<div class="flex items-center gap-3 text-sm text-gray-400 mb-4">
											<span class="flex items-center gap-1">
												<svg
													class="w-4 h-4"
													fill="none"
													stroke="currentColor"
													viewBox="0 0 24 24"
												>
													<path
														stroke-linecap="round"
														stroke-linejoin="round"
														stroke-width="2"
														d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
													/>
												</svg>
												{post.metadata?.publishedAt
													? new Date(
															post.metadata.publishedAt
													  ).toLocaleDateString(
															"es-ES",
															{
																month: "short",
																day: "numeric",
																year: "numeric",
															}
													  )
													: "N/A"}
											</span>
											<span>·</span>
											<span class="flex items-center gap-1">
												<svg
													class="w-4 h-4"
													fill="none"
													stroke="currentColor"
													viewBox="0 0 24 24"
												>
													<path
														stroke-linecap="round"
														stroke-linejoin="round"
														stroke-width="2"
														d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
													/>
												</svg>
												{post.metadata?.readingTime ||
													5}{" "}
												min
											</span>
										</div>

										<p class="text-gray-600 mb-6 line-clamp-3 leading-relaxed flex-1">
											{post.metadata?.seoDescription ||
												"Sin descripción disponible."}
										</p>

										<a
											href={`/posts/${
												post.metadata?.slug || post.id
											}`}
											class="inline-flex items-center text-[#007BFF] font-bold group-hover:underline decoration-2 underline-offset-2 transition-all"
										>
											Leer completo
											<svg
												class="w-4 h-4 ml-1 transform group-hover:translate-x-1 transition-transform"
												fill="none"
												stroke="currentColor"
												viewBox="0 0 24 24"
											>
												<path
													stroke-linecap="round"
													stroke-linejoin="round"
													stroke-width="2"
													d="M17 8l4 4m0 0l-4 4m4-4H3"
												/>
											</svg>
										</a>
									</div>
								</article>
							))}
						</div>
					) : (
						<div class="text-center py-32 bg-white rounded-3xl border border-dashed border-gray-200">
							<div class="inline-flex items-center justify-center w-20 h-20 bg-gray-50 rounded-full mb-6">
								<svg
									class="w-10 h-10 text-gray-300"
									fill="none"
									stroke="currentColor"
									viewBox="0 0 24 24"
								>
									<path
										stroke-linecap="round"
										stroke-linejoin="round"
										stroke-width="1.5"
										d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"
									/>
								</svg>
							</div>
							<h3 class="text-xl font-bold text-gray-900 mb-2">
								Base de Datos Vacía
							</h3>
							<p class="text-gray-500 max-w-sm mx-auto">
								No hay artículos publicados aún. Usa el script
								de inyección para añadir contenido.
							</p>
						</div>
					)
				}
			</div>
		</div>
	</section>
</Layout>
